<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lens Eyecare Algorithms</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f7fc;
        }

        header {
            background-color: #4CAF50;
            color: white;
            padding: 20px;
            text-align: center;
        }

        header h2 {
            margin: 0;
            font-size: 2rem;
        }

        .container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .section {
            margin-bottom: 40px;
            padding: 20px;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }

        h3 {
            text-align: center; /* Centers the section title */
            font-size: 1.8rem; /* Adjusts the font size of the heading */
            color: #333; /* Sets the heading color */
            margin-bottom: 20px; /* Adds space below the heading */
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            color: #333;
        }

        input[type="file"], input[type="text"], input[type="button"], input[type="submit"], button {
            width: 100%;
            padding: 12px;
            margin-top: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
            font-size: 1rem;
            box-sizing: border-box;
        }

        input[type="file"] {
            border: none;
        }

        input[type="button"], input[type="submit"], button {
            background-color: #007bff; /* Blue color */
            color: white;
            border: none;
        }     

        .instructions {
            font-size: 1rem;
            color: #555;
            line-height: 1.8;
            text-align: center; /* Centers the text */
            max-width: 800px; /* Optional: Limits the width for better readability */
            margin: 0 auto; /* Centers the container */
        }

        .instructions h3 {
            text-align: center; /* Centers the heading */
            font-size: 1.5rem; /* Optional: Adjusts the size for better visibility */
            color: #333; /* Optional: Adjusts the color to match your design */
            margin-top: 0; /* Removes any extra top margin */
        }

        .instructions ul {
            list-style: none;
            padding: 0;
            margin: 0;
            text-align: left; /* Aligns the list to the left inside the centered container */
            display: inline-block; /* Makes the list behave like a block but still centered */
        }

        .instructions li {
            margin-bottom: 10px;
            padding-left: 0; /* Removes unnecessary indentation */
            text-indent: 0; /* Removes any previous text indentation */
        }   

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 10px;
            text-align: left;
            border: 1px solid #ddd;
        }

        th {
            background-color: #f4f7fc;
        }

        .delete-section {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
        }

        .delete-section input {
            width: 60%;
        }

        .footer {
            background-color: #4CAF50;
            color: white;
            text-align: center;
            padding: 10px;
            position: fixed;
            width: 100%;
            bottom: 0;
        }

    </style>
</head>
<body>
    <header>
        <h2>Lens Rating Algorithms</h2>
    </header>

    <section id="background" style="padding: 40px 20px; background-color: #f9f9f9; border-radius: 8px; margin: 30px auto; max-width: 900px;">
        <h3 style="color: #333; font-size: 24px; text-align: center; margin-bottom: 20px;">Background on Lens Transmission Spectrum and Metrics</h3>
        <p style="font-size: 16px; line-height: 1.8; color: #555; text-align: justify;">
            The transmission spectrum of a lens describes how the lens transmits light across different wavelengths. It indicates the amount of light that passes through the lens at each wavelength, providing crucial information about the lens' ability to block harmful rays or allow beneficial light to pass. The transmission spectrum typically ranges from 380nm (UV) to 750nm (visible light), with specific interest in how the lens blocks or transmits light in certain regions, such as UV and blue light.
        </p>
        
        <h4 style="font-size: 20px; color: #333; margin-top: 40px; text-align: center;">Lens Metrics</h4>
        
        <table style="width: 100%; border-collapse: collapse; margin-top: 20px; background-color: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);">
            <thead>
                <tr style="background-color: #007BFF; color: #333;">
                    <th style="padding: 12px; text-align: left; font-size: 16px;">Metric</th>
                    <th style="padding: 12px; text-align: left; font-size: 16px;">Value</th>
                </tr>
            </thead>
            <tbody>
                <tr style="background-color: #f2f2f2;">
                    <th style="padding: 12px;">ID</th>
                    <td id="lensId" style="padding: 12px; color: #555;"></td>
                </tr>
                <tr>
                    <th style="padding: 12px;">Name</th>
                    <td id="lensName" style="padding: 12px; color: #555;"></td>
                </tr>
                <tr style="background-color: #f2f2f2;">
                    <th style="padding: 12px;">R-Squared</th>
                    <td id="lensRSquared" style="padding: 12px; color: #555;"></td>
                </tr>
                <tr>
                    <th style="padding: 12px;">Transmission Average</th>
                    <td id="lensTransmissionAvg" style="padding: 12px; color: #555;"></td>
                </tr>
                <tr style="background-color: #f2f2f2;">
                    <th style="padding: 12px;">Eye Protection Factor</th>
                    <td id="lensEyeProtectionFactor" style="padding: 12px; color: #555;"></td>
                </tr>
                <tr>
                    <th style="padding: 12px;">Melatonin Production Factor</th>
                    <td id="lensMelatoninProductionFactor" style="padding: 12px; color: #555;"></td>
                </tr>
                <tr style="background-color: #f2f2f2;">
                    <th style="padding: 12px;">Glare Reduction Factor</th>
                    <td id="lensGlareReductionFactor" style="padding: 12px; color: #555;"></td>
                </tr>
            </tbody>
        </table>
    
        <div style="margin-top: 40px;">
            <h4 style="font-size: 20px; color: #333; text-align: center;">Metric Descriptions</h4>
            <div style="font-size: 16px; line-height: 1.8; color: #555;">
                <p><strong>R-Squared:</strong> A measure of how well the lens's transmission spectrum data fits a linear regression model. A higher R-squared value indicates better data consistency.</p>
                <p><strong>Transmission Average:</strong> The average percentage of light transmitted by the lens across the wavelength range. This metric helps evaluate overall lens performance.</p>
                <p><strong>Eye Protection Factor:</strong> Indicates how effectively the lens protects the eyes from harmful UV and blue light. Higher values suggest better protection.</p>
                <p><strong>Melatonin Production Factor:</strong> A measure of how the lens affects the bodyâ€™s melatonin production, which can be influenced by blue light exposure. A lower value generally indicates less disruption to sleep patterns.</p>
                <p><strong>Glare Reduction Factor:</strong> Measures the lens's ability to reduce glare from bright light sources. Higher values indicate better glare reduction, which can enhance visual comfort.</p>
            </div>
        </div>
    </section>
    
            <!-- Instructions Section -->
    <section class="section">
        <div class="instructions">
            <h3>Instructions for Uploading Data</h3>
            <ul>
                <li>    1. Select a file from your computer containing spectrophotometer scan results.</li>
                <li>    2. Ensure the file is saved in a compatible format such as CSV or Excel.</li>
                <li>    3. Open the file in Excel to review the data.</li>
                <li>    4. Delete any columns not containing data within the wavelength range of 380nm to 750nm.</li>
                <li>    5. Ensure that the file only contains data for every 10nm. Do not include intermediate values.</li>
                <li>    6. Save the file as a txt file with the necessary data range containing the data for every 10nm.</li>
                <li>    7. Click "Submit" to upload the prepared file for processing.</li>
            </ul>
            <p>Ensure all wavelengths from 380nm to 750nm are covered with their respective transmittance and absorption values. This data is crucial for calculating lens ratings.</p>
        </div>
    </section>


        <!-- File Upload Section -->
        <section class="section">
            <h3>Upload Data</h3>
            <form id="uploadForm">
                <div class="form-group">
                    <label for="fileName">File Name:</label>
                    <input type="text" id="fileName" name="fileName" placeholder="Enter the file name">
                </div>
                <div class="form-group">
                    <label for="file">Select a file:</label>
                    <input type="file" id="file" name="file" required>
                </div>
                <input type="button" value="Submit" onclick="uploadFile()">
            </form>
        </section>

        <!-- Lens Details Section -->
        <section class="section" id="result" style="display:none;">
            <h3>Lens Details</h3>
            <table id="lensDetails">
                <tr><th>ID</th><td id="lensId"></td></tr>
                <tr><th>Name</th><td id="lensName"></td></tr>
                <tr><th>R-Squared</th><td id="lensRSquared"></td></tr>
                <tr><th>Transmission Average</th><td id="lensTransmissionAvg"></td></tr>
                <tr><th>Eye Protection Factor</th><td id="lensEyeProtectionFactor"></td></tr>
                <tr><th>Melatonin Production Factor</th><td id="lensMelatoninProductionFactor"></td></tr>
                <tr><th>Glare Reduction Factor</th><td id="lensGlareReductionFactor"></td></tr>
            </table>
            <canvas id="chart" width="400" height="200" style="display:none;"></canvas>
        </section>

        <!-- Delete Section -->
        <section class="section delete-section">
            <h3>Delete Lens</h3>
            <label for="lensIdInput">Enter Lens ID:</label>
            <input type="text" id="lensIdInput" name="lensIdInput" placeholder="Enter ID">
            <button onclick="deleteLens()">Delete Lens</button>
        </section>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p>2025 Photoprotective Technologies Lens Rating Algorithms | Developed by Timothy Berlanga</p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-trendline"></script>
    <script>
      function uploadFile() {
    const fileInput = document.getElementById('file');
    const fileNameInput = document.getElementById('fileName');
    const file = fileInput.files[0];
    const fileName = fileNameInput.value.trim();

    if (!file) {
        alert("Please select a file.");
        return;
    }

    const formData = new FormData();
    formData.append('file', file);
    if (fileName) {
        formData.append('fileName', fileName);
    }

    // Debugging: Log FormData
    console.log([...formData]);

    fetch('http://localhost:8080/upload', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(lens => {
        localStorage.setItem('lensData', JSON.stringify(lens));
        window.location.href = 'lens-details.html'; // Redirect to lens-details.html
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Failed to upload file.');
    });
}

        function deleteLens() {
            let lensId = document.getElementById('lensIdInput').value;
            if (lensId.trim() === '') {
                alert('Please enter a valid Lens ID.');
                return;
            }

            fetch(`http://localhost:8080/lens/${lensId}`, {
                method: 'DELETE'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to delete lens.');
                }
                alert(`Lens with ID ${lensId} deleted successfully.`);
                location.reload(); // Refresh the page to reflect changes
            })
            .catch(error => {
                alert(`Error deleting lens: ${error.message}`);
            });
        }
    </script>
</body>
</html>




    <!-- <div class="instructions manual"> -->
        <!-- <h3>Step-by-Step Instructions for Manual Data Entry</h3>
        <ol>
            <li>To Enter the Data Manually:
                <ul>
                    <li>For each wavelength from 380nm to 750nm:
                        <ul>
                            <li>Enter the transmittance (%T) in the corresponding field.</li>
                            <li>Enter the absorption (ABS) in the corresponding field.</li>
                        </ul>
                    </li>
                    <li>Click "Submit" once all data is entered.</li>
                </ul>
            </li>
        </ol>
        <p>Ensure all wavelengths from 380nm to 750nm are covered with their respective transmittance and absorption values. This data is crucial for calculating lens ratings.</p>
    </div>
    <h3>Enter Data Manually</h3>
    <form action="http://localhost:8080/submit-data" method="post">
        <div class="manual-entry">
            <table>
                <thead>
                    <tr>
                        <th>Wavelength (nm)</th>
                        <th>Transmittance (%T)</th>
                        <th>ABS</th>
                    </tr>
                </thead>
                <tbody id="dataRows">
                    Autofilled rows will be inserted here 
                 </tbody>
            </table>
        </div>
        <input type="submit" value="Submit">
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var tbody = document.getElementById('dataRows');

            // Generate rows for wavelengths from 380nm to 750nm
            for (var wavelength = 380; wavelength <= 750; wavelength += 10) {
                var tr = document.createElement('tr');

                // Wavelength input (read-only)
                var wavelengthInput = document.createElement('input');
                wavelengthInput.type = 'text';
                wavelengthInput.id = 'wavelength' + wavelength;
                wavelengthInput.name = 'wavelength' + wavelength;
                wavelengthInput.value = wavelength;
                wavelengthInput.readOnly = true;
                var tdWavelength = document.createElement('td');
                tdWavelength.appendChild(wavelengthInput);
                tr.appendChild(tdWavelength);

                // Transmittance input
                var transmittanceInput = document.createElement('input');
                transmittanceInput.type = 'text';
                transmittanceInput.id = '%t' + wavelength;
                transmittanceInput.name = '%t' + wavelength;
                var tdTransmittance = document.createElement('td'); 
                tdTransmittance.appendChild(transmittanceInput);
                tr.appendChild(tdTransmittance);

                // ABS input
                var absInput = document.createElement('input');
                absInput.type = 'text';
                absInput.id = 'abs' + wavelength;
                absInput.name = 'abs' + wavelength;
                var tdAbs = document.createElement('td');
                tdAbs.appendChild(absInput);
                tr.appendChild(tdAbs);

                tbody.appendChild(tr);
            }
        });
    </script>
</body>
</html> -->
